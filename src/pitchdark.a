;license:MIT
;(c) 2018 by 4am

!cpu 65c02
!to "../build/PTCHDARK.SYSTEM#FF2000",plain
*=$2000

; ROM routines
INVERSE = $FE80
NORMAL = $FE84

         jmp   Init

         !source "WeeGUI_MLI.s"
         !source "prodos.a"

Init
         lda   MACHID
         and   #$30
         cmp   #$30                  ; 128K?
         beq   +                     ; yes, continue
         jmp   QuitToProDOS
+
         jsr   LoadFile1Shot
         !word WGFILE
         !word $4000
         !word $2000
         !word $1C00

         jsr   $4000
         ldx   #WGClearScreen
         jsr   WeeGUI

         ldx   #WGCreateView
         lda   #<view0
         sta   PARAM0
         lda   #>view0
         sta   PARAM1
         jsr   WeeGUI

         jsr   INVERSE
         ldx   #WGPrint
         lda   #<title
         sta   PARAM0
         lda   #>title
         sta   PARAM1
         jsr   WeeGUI
         jsr   NORMAL

         bit   $c010
-        lda   $c000
         bpl   -
         ldx   #WGExit
         jsr   WeeGUI
         jmp   QuitToProDOS

WGFILE    !byte wg_e-wg_b
wg_b      !text "WEEGUI"
wg_e

view0    !byte 0                     ; view ID
         !byte 0                     ; style
         !byte 0                     ; left
         !byte 0                     ; top
         !byte 79                    ; visible width
         !byte 1                     ; visible height
         !byte 79                    ; width
         !byte 1                     ; height

title    !text "Pitch Dark                                                                      ",0
