;license:MIT
;(c) 2018 by 4am
;
; Global and per-game preferences
;
; Public functions
; - LoadGlobalPreferences
; - SaveGlobalPreferences
;
; Public variables
; - gCurrentGame          byte       0..kNumberOfGames-1
;
; Public constants
; - kForce40
; - kForceUpper
; - kSort
; - kLastPlayed

!zone {
kDefaultGame              = 30       ; Zork I

; global storage for parsed preference values
gCurrentGame
         !byte 0

kForce40
         !byte 14
         !raw  "FORCE40COLUMNS"
kForceUpper
         !byte 14
         !raw  "FORCEUPPERCASE"
kSort
         !byte 4
         !raw  "SORT"
kLastPlayed
         !byte 10
         !raw  "LASTPLAYED"

;------------------------------------------------------------------------------
; LoadGlobalPreferences
;
; in:    current ProDOS prefix is the same as the PITCH.DARK binary
; out:   all registers and flags clobbered
;------------------------------------------------------------------------------
LoadGlobalPreferences
         lda   #kDefaultGame
         sta   gCurrentGame

         jsr   okvs_init
         !word gPrefsStore

         jsr   okvs_append
         !word gPrefsStore
         !word kForce40
         !word .debug0
         !byte 0

         jsr   okvs_append
         !word gPrefsStore
         !word kForceUpper
         !word .debug0
         !byte 0

         jsr   okvs_append
         !word gPrefsStore
         !word kSort
         !word .debugsortvalue
         !byte 11

         jsr   okvs_append
         !word gPrefsStore
         !word kLastPlayed
         !word .debuglastplayed
         !byte 16

         jsr   okvs_update
         !word gPrefsStore
         !word kSort
         !word kByDifficulty
         bcs   .exit
         ;jmp   $ff59

         bra   .exit
         ; TODO
         jsr   LoadFile              ; load prefs file at $2000
         !word .globalPrefsFilename
         !word $2000
         !word $2000
         !word kProDOSFileBuffer
         bcs   .exit
.exit
         rts

SaveGlobalPreferences
         ; TODO
         rts

.globalPrefsFilename
         !byte 15
         !raw  "PITCH.DARK.CONF"

.debug0
         !byte 1
         !raw  "0"

.debugsortvalue
         !byte 4
         !raw  "NAME"

.debuglastplayed
         !byte 6
         !raw  "ZORK.I"

kByDifficulty
         !byte 10
         !raw  "DIFFICULTY"
}
